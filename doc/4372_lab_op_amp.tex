\chapter{Op Amps}

\section{MCP 3008}

The MCP 3008 is an 8 channel, 10 bit A/D converter that is bus addressable.  Communication is through a SPI bus.  Our Raspberry Pi has hardware support\footnote{If you had a controller that didn't have hardware support you would have to implement it in software, which is very slow and called bit banging.  I have included a bit banging code for your reference in the code part of lab 3.}.  There are four code sequences I have provided:
\begin{enumerate}
\item mcp3008bitbang.py - slow software SPI bus.  Don't use, this is only for reference if you don't have a system with hardware support.
\item mcp3008hw.py - fast hardware SPI bus.  outputs values on command line to 3 decimal places.  Good for getting precise values, but bad for lots of values.
\item mcp3008plot.py - hardware SPI bus that plots the results on a graph.  Tends to be slow because it has to sample and plot.
\item mcp3008plot-thread.py - multi-threaded hardware SPI bus that plots the result on a graph.  Yes I was having fun...  This has three threads, one that reads, one that outputs a square wave, and one that plots.  Syntax for the plot commands follows MatLab standards.  Fast and oh so much fun.
\end{enumerate}
These, of course, require library support so we have written an install shell script.  You will need to navigate to where it is located, change its permissions so it is executable, then run it.  From a terminal window type:

\CommandLine{sudo raspi-config}

Select interface setup, then enable SPI, I2C, and 1-wire by selecting them and then yes.  Note you have to do this three click process for each.  Once done you will be prompted to reboot, which needs to be done at this point since you changed OS options.  Once the system has rebooted open a terminal window and type:

\CommandLine{cd ~/code/labs/labs}

\CommandLine{chmod 755 \url{install_python_libs.sh}}

\CommandLine{\url{./install_python_libs.sh}}

The mcp3008 has an analog power reference(Vref) and ground and a digital power (Vdd) and ground.  Vdd must always be connected to 3v3 (3.3V) and its ground (pin 9) to ground.  Vref and analog ground define the voltage range to compare.  Often this is the same, but it doesn't have to be.  For instance, connecting to 5v gives a bigger swing.  Remember that the chip only has 10 bits of precision (just over 1000 divisions) and thus the precision is:
$$
\frac{V_{ref}-A_{gnd}}{2^{10}}
$$
Thus the larger the reference swing, the less precise the measurement.  If you want to measure something small, you should have a small reference!  The basic hookup is thus

\includegraphics[width=0.8\textwidth]{../images/mcp3008_circuit.png}

Note the voltage divider on the left is only for testing and does not need to be done each time.  You will build the divider the first time to test your code and setup.  The 8 pins on the left are now available for measuring your circuit.

\section{Follower}

We will be using a general purpose LM358 Op Amp.  We will connect the positive rail to 3v3 and the negative rail to ground.  Hook the output to the negative input and the signal to follow goes on the positive input.  The pinout of the 358 is:

\includegraphics[width=0.4\textwidth]{../images/lm358.jpg}


\section{Inverting Amplifier}

Note we thus can't get negative voltages, but we have no choice since we don't have a negative voltage.  We can make a new reference ground by a voltage divider between 3v3 and ground across a 1k potentiometer\footnote{hook 3v3 to one outer pin and ground to the other, the center tap is the reference}, so the center will be 1v6.  Hook this to the positive input, and the rails should be connected to 3v3 and ground.  Hook the Vref on the MCP3008 to 3v3.  Now make another potentiometer voltage divider, this time running from the op amp's output to gpio 4, with the central tap going to the op amp's negative (inverting) input.



